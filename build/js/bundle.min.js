"use strict";function Dashboard(){this.globalState=!1,this.messages=["Create new card","Delete card","Changes saved","All fields are required"],this.area={main:document.querySelector(".main-content"),container:document.querySelector(".content-area"),submit:document.querySelector(".btn-submit"),message:document.querySelector(".message")},this.sidebar={title:document.querySelector(".input--title"),content:document.querySelector(".input--content"),author:document.querySelector(".input--author")},this.buttons={submit:document.querySelector(".btn-submit")}}function Task(e){Dashboard.call(this),this.id=nextID++,this.posX=0,this.posY=0,this.resizeX=0,this.resizeY=0,this.encodeData=JSON.parse(e),this.onDrag=this.draggable.bind(this),this.onResize=this.resize.bind(this),this.activeText=null,this.currentText=null,this.editArea=!1,this.activeArea=!0,this.single={article:document.createElement("article"),header:document.createElement("header"),h:document.createElement("h2"),hText:document.createTextNode(""),paragraph:document.createElement("p"),paragraphText:document.createTextNode(""),author:document.createElement("p"),authorText:document.createTextNode(""),edit:document.createElement("span"),resize:document.createElement("div")},this.initTask(),tasks.push(this),current.push(this.id)}var current=[],tasks=[],nextID=0;Dashboard.prototype.validate=function(){if(!this.globalState){var e={};for(var t in this.sidebar){if(!this.sidebar.hasOwnProperty(t)||!this.sidebar[t].value)return this.log("All fields are required"),!1;e[t]=this.sidebar[t].value}new Task(JSON.stringify(e)),this.removeFields()}},Dashboard.prototype.removeFields=function(){for(var e in this.sidebar)this.sidebar.hasOwnProperty(e)&&(this.sidebar[e].value="")},Dashboard.prototype.log=function(e){for(var t=0;t<this.messages.length;t++)this.messages.indexOf(e)===t&&(this.area.message.classList.add("animate-msg"),this.area.message.textContent=this.messages[t]);setTimeout(function(){this.area.message.classList.remove("animate-msg")}.bind(this),3e3)},Dashboard.prototype.init=function(){this.validate()},Task.prototype=Object.create(Dashboard.prototype),Task.prototype.constructor=Task,Task.prototype.create=function(){this.single.article.classList.add("task"),this.single.article.classList.add("task"+this.id),this.single.article.appendChild(this.single.edit),this.single.article.appendChild(this.single.header),this.single.article.appendChild(this.single.paragraph),this.single.article.appendChild(this.single.author),this.single.article.appendChild(this.single.resize),this.single.header.appendChild(this.single.h),this.single.resize.classList.add("resize"),this.single.edit.classList.add("icon-edit"),this.single.header.classList.add("task-header"),this.single.h.classList.add("task-header__title"),this.single.paragraph.classList.add("task__text"),this.single.author.classList.add("task__author"),this.single.h.appendChild(this.single.hText),this.single.h.appendChild(document.createElement("span")),this.single.paragraph.appendChild(this.single.paragraphText),this.single.paragraph.appendChild(document.createElement("span")),this.single.author.appendChild(this.single.authorText),this.single.author.appendChild(document.createElement("span")),this.single.hText.textContent=this.encodeData.title,this.single.paragraphText.textContent=this.encodeData.content,this.single.authorText.textContent=this.encodeData.author,this.area.container.appendChild(this.single.article),this.removeFields(),this.log("Create new card")},Task.prototype.pressedMouse=function(e){e.target!==this.single.edit&&(this.posX=e.clientX-this.single.article.offsetLeft,this.posY=e.clientY-this.single.article.offsetTop,this.edit(e),document.addEventListener("mousemove",this.onDrag)),e.target===this.single.resize&&(this.resizeX=e.clientX-this.single.article.clientWidth,this.resizeY=e.clientY-this.single.article.clientHeight,document.removeEventListener("mousemove",this.onDrag),document.addEventListener("mousemove",this.onResize)),e.target===this.single.edit&&(this.editArea=!this.editArea,this.current(e),this.edit(e))},Task.prototype.mouseUp=function(){document.removeEventListener("mousemove",this.onDrag),document.removeEventListener("mousemove",this.onResize)},Task.prototype.draggable=function(e){var t=e.clientX-this.posX,i=e.clientY-this.posY,s=this.area.container.clientWidth-this.single.article.clientWidth,a=this.area.container.clientHeight-this.single.article.clientHeight;t>=s&&(t=s),i>=a&&(i=a),t<0&&(t=0),i<0&&(i=0),this.single.article.style.left=t+"px",this.single.article.style.top=i+"px"},Task.prototype.resize=function(e){var t=this.area.container.clientWidth-this.single.article.offsetLeft,i=this.area.container.clientHeight-this.single.article.offsetTop,s=e.clientX-this.resizeX,a=e.clientY-this.resizeY,n=150;s>=t&&(s=t),s<=n&&(s=n),a>=i&&(a=i),this.single.article.style.width=s+"px",this.single.article.style.minHeight=a+"px"},Task.prototype.edit=function(e){if(this.editArea){for(var t in this.single)this.single[t]===this.single.h&&this.activeArea?(this.activeText=this.single[t].childNodes[0].nodeValue,this.currentText=this.single[t].childNodes,this.currentText[1].classList.add("index")):this.single[t]===e.target&&this.single[t]!==this.single.edit&&this.single[t]!==this.single.resize&&this.single[t]!==this.single.article&&this.single[t]!==this.single.header&&(this.currentText[1].classList.remove("index"),this.activeText=this.single[t].childNodes[0].nodeValue,this.currentText=this.single[t].childNodes,this.currentText[1].classList.add("index"),this.activeArea=!1);if(8===e.keyCode)this.activeText=this.activeText.slice(0,this.activeText.length-1),this.currentText[0].textContent=this.activeText;else if(13===e.keyCode)this.currentText[1].classList.remove("index"),this.log("Changes saved"),this.editArea=!1,this.activeArea=!0;else if(27===e.keyCode);else if(e.keyCode){var i=this.activeText+=e.key;this.currentText[0].textContent=i}}else{for(var t in this.single)this.single[t].childNodes[1]&&this.single[t].childNodes[1].classList.remove("index");this.activeArea=!0}},Task.prototype.current=function(e){var t=this;current.forEach(function(i,s){e.target===t.single.edit&&(i===t.id||(tasks[s].editArea=!1,tasks[s].edit()))})},Task.prototype.initTask=function(){this.create(),this.single.article.addEventListener("mousedown",this.pressedMouse.bind(this)),document.addEventListener("mouseup",this.mouseUp.bind(this)),document.addEventListener("keydown",this.edit.bind(this))},window.addEventListener("load",function(){var e=new Dashboard;e.buttons.submit.addEventListener("click",function(t){t.preventDefault(),e.init()})});